<%- include('partials/header') -%>
<div class="container">
  <div class="row justify-content-center mt-5">
    <div class="col-6">
      <h2><%= project.projectName %></h2>


    </div>
    <div class="col-3 mt-5">
      <h3>Project Number:</h3>
      <%= project.projectNumber %>
      <p><br></p>
      
      <h3>Project Description:</h3>
      <%= project.projectDescription %>
      <p><br></p>

      <h3>Total locations created : <b><%= workLocations.length %></b></h3>
      <p></br></p>

      <h3>Assigned Employees:</h3><br>
      <ul>
        <% for (var i=0; i<employees.length; i++){%>
          <li class ="col-6 justify-content-between mt-5"> 
              <span>Uploaded By:  <%= employees[i]%></span>
              <br>
        </li>
      <% } %>    
      </ul>
      <div class="mt-5">
        <form action="/project/addEmployees/<%=project._id%>" method="POST">
          <div class="mb-3">
              <label for="comment" class="form-label">Assign An Employee</label>
              <input type="text" class="form-control" id="assignedEmployee" name="assignedEmployee">
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>
      

    <h3 class="project-heading">Document Section</h3>
      <span>Files accepted: .pdf, .png, .img, .jpg, and .jpeg</span>
    <ul>
      <form action="/document/createDocument/<%=project._id%>" enctype="multipart/form-data" method="POST">
        <div class ="mb-3">
          <label for="fileName" class = "form-label">Document Name</label>
          <input type = "text" class="form-control" id="fileName" name="fileName">
        </div>
        <div class ="mb-3">
          <label for="description" class="form-label">Document Description</label>
          <input type="text" class="form-control" id="Description" name="description">
        </div>
        <div class ="mb-3">
          <label for="fileUpload" class="form-label">Document File</label>
          <input type="file" class="form-control" id="documentUpload" name="file">
        </div>
          <button type="submit" class ="btn btn-primary">Submit Document</button>
      </form>
    </ul>

      
        <div>
            <ul class="flex-grid">
              <% for (var i=0; i<nonImageDocuments.length; i++){%>
                <li class ="document-item"> 
                  <a class ="template-heading" href="<%=nonImageDocuments[i].image%>" download><%=nonImageDocuments[i].fileName%></a>
                    <form action="/document/deleteDocument/<%=project._id%>/<%=nonImageDocuments[i]._id %>?_method=DELETE" method="POST">
                    <span>Uploaded By:  <%=  nonImageDocuments[i].uploadedById.firstName%> <%=  nonImageDocuments[i].uploadedById.lastName%></span>
                    <br>
                      <button type="submit" class="btn btn-secondary">Delete Document</button>
                    </form>
              </li>
            <% } %>    
            </ul>
        </div>
      
      <div class="container">
        <h3 class="project-heading">Create a New Work Location</h3>
        <form id="newWorkLocationForm" action="/template/createNewWorkLocation/<%=project._id%>" method="POST">
          <div class="form-group">
            <label for="templateSelect">Select Template:</label>
            <select class="form-control" id="templateSelect" name="selectedTemplate" required>
              
                <% templates.forEach(template => { %>
                  <% if(template.isOriginal===true){ %>
                  <option value="<%= template._id %>"><%= template.templateName %></option>
                  <% } %>
                <% }) %>
              
            </select>
          </div>
          <div class="form-group">
            <label for="location">Location:</label>
            <input type="text" class="form-control" id="location" name="location" required>
          </div>
          <button type="submit" class="btn btn-primary">Create Work Location</button>
        </form>
      </div>

      <div>
        <h3 class="project-heading"> Current Work Locations </h3>
        <div class="location-container">
          
          <% workLocations.forEach(object => { %>
            <% if(object.isOriginal===false && object){ %>

            <details class="work-location">
            <summary>
              <h4 class="template-heading">Location:</h4>
                <h6 class="template-heading-detail"><%= object.location%></h6>
              <h5 class="template-heading">Work Performed:</h5><%= object.templateName %>
              <h5 class="template-heading">Task completion:</h5> <%= object.totalSignatures %> / <%= object.tasks.length %></h5>


            </summary>
            <ul>
                <% object.tasks.forEach(task => { %>
                    <li class="template-task">
                        <%= task.taskDetail %>

                        
                    </li>
                    <li class="signature-box">
                      <form action="/template/signTask/<%= project._id %>/<%= object._id %>/<%= object._id %>/<%= task._id %>/?_method=PUT" method="POST">
                        <button class="btn btn-primary signature-btn" type="submit">Signature Here</button>
                      </form>
                      <% task.signature.forEach(signature => { %>
                        
                        <div>
                          <span><b>Signed by</b>: <%= signature.initial %></span> /
                          <span><b>Date</b>: <%= signature.dateCompleted.toDateString() %></span>
                          <form action ="/template/deleteSignature/<%= project._id%>/<%= object._id %>/<%= object._id%>/<%= task._id %>/<%= signature._id %>/?_method=DELETE" method = "POST"><button><i class="fa-solid fa-trash"></i></button>
                          </form>
                        </div>

                      <% }) %>
                    </li>
                    <br>
                    <% }) %>
                    <form class="delete-signature" action ="/template/deleteWorkLocation/<%=project._id%>/<%=object._id %>?_method=DELETE" method = "POST">
                      <button  class="btn btn-secondary" type="submit">Delete this Work Location</button>
                    </form>
                  </details>
                <% }else { %>
                <%}%>
            </ul>
            
        <% }) %>
        </div>
      </div>

      <div class="container">
        <h3 class="project-heading ">Pictures</h3>
            <div>
              <ul class="flex-grid">
                <% for (var i=0; i<imageDocuments.length; i++){%>
                  <li class ="image-item"> 
                    <a class ="template-heading document-heading" href="<%=imageDocuments[i].image%>" download><%=imageDocuments[i].fileName%></a>
                    <img class="images" src="<%=imageDocuments[i].image%>">
                    <p><b>Image Description:</b> <%= imageDocuments[i].description %></p>
                      <form action="/document/deleteDocument/<%=project._id%>/<%=imageDocuments[i]._id %>?_method=DELETE" method="POST">
                        <br>
                        <span><b>Date Submitted:</b> <%= imageDocuments[i].dateSubmitted.toDateString()%></span>
                        <span><b>Submitted By:</b> <%= imageDocuments[i].uploadedById.firstName%> <%= imageDocuments[i].uploadedById.lastName%></span>

                        <button type="submit" class="btn btn-secondary">Delete Document</button>
                      </form>
                </li>
              <% } %>    
              </ul>
          </div>
      </div>
  
    <div class="col-6 mt-5">
        <div>
          <form action ="/project/deleteProject/<%=project._id%>?_method=DELETE" method = "POST">
            <button  class="btn btn-primary" type="submit">Delete this Project</button>
          </form>
        </div>
      <a class="btn btn-primary" href="/profile">Return to Profile</a>
      <a class="btn btn-primary" href="/feed">Return to <%= user.company %> projects.</a>
    </div>
    
  </div>
</div>


<%- include('partials/footer') -%>